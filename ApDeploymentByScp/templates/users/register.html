<!DOCTYPE html>
<html lang="en">
<head>
    <!-- Required meta tags -->
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.0/dist/css/bootstrap.min.css"
          integrity="sha384-9aIt2nRpC12Uk9gS9baDl411NQApFmC26EwAOH8WgZl5MYYxFfc+NcPb1dKGj7Sk" crossorigin="anonymous">
    <link rel="stylesheet" href="/static/css/uploadCad.css">
    <!-- plugins:css -->
    <link rel="stylesheet" href="/static/assets/vendors/iconfonts/mdi/css/materialdesignicons.min.css">
    <link rel="stylesheet" href="/static/assets/vendors/iconfonts/ionicons/css/ionicons.css">
    <link rel="stylesheet" href="/static/assets/vendors/iconfonts/typicons/src/font/typicons.css">
    <link rel="stylesheet" href="/static/assets/vendors/iconfonts/flag-icon-css/css/flag-icon.min.css">
    <link rel="stylesheet" href="/static/assets/vendors/css/vendor.bundle.base.css">
    <link rel="stylesheet" href="/static/assets/vendors/css/vendor.bundle.addons.css">
    <!-- endinject -->
    <!-- plugin css for this page -->
    <link rel="stylesheet" href="/static/assets/vendors/icheck/skins/all.css">
    <!-- End plugin css for this page -->
    <!-- inject:css -->
    <link rel="stylesheet" href="/static/assets/css/shared/style.css">
    <!-- endinject -->
    <!-- Layout styles -->
    <link rel="stylesheet" href="/static/assets/css/demo_1/style.css">
    <!-- End Layout styles -->
    <title>注册</title>
</head>
<body>
<form enctype="multipart/form-data" method="POST" id="loginform">
    {% csrf_token %}
<div class="container-scroller">
      <div class="container-fluid page-body-wrapper full-page-wrapper">
        <div class="content-wrapper d-flex align-items-center auth theme-one">
          <div class="row w-100">
            <div class="col-lg-4 mx-auto">
              <h2 class="text-center mb-4">注册</h2>
              <div class="auto-form-wrapper">
                <form action="#">
                  <div class="form-group">
                    <div class="input-group">
                      <input id="username" type="text" class="form-control" placeholder="Username">
                      <div class="input-group-append">
                        <span class="input-group-text">
                          <i class="mdi mdi-check-circle-outline"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="input-group">
                      <input id="password" type="password" class="form-control" placeholder="Password">
                      <div class="input-group-append">
                        <span class="input-group-text">
                          <i class="mdi mdi-check-circle-outline"></i>
                        </span>
                      </div>
                    </div>
                  </div>
                  <div class="form-group">
                    <div class="input-group">
                      <input id="confirm_password" type="password" class="form-control" placeholder="Confirm Password">
                      <div class="input-group-append">
                        <span class="input-group-text">
                          <i class="mdi mdi-check-circle-outline"></i>
                        </span>
                      </div>
                    </div>
                  </div>

                  <div class="form-group">
                    <button type="button" class="btn btn-primary submit-btn btn-block" onclick="checkInput();">注册</button>
                  </div>
                  <div class="text-block text-center my-3">
                    <span class="text-small font-weight-semibold">已经有账号了 ?</span>
                    <a href="{% url 'users:login' %}" class="text-black text-small">去登陆</a>
                  </div>
                </form>
              </div>
            </div>
          </div>
        </div>
        <!-- content-wrapper ends -->
      </div>
      <!-- page-body-wrapper ends -->
    </div>
</form>
<!-- 提示模块（用户名或密码不能为空） -->
<div class="modal fade" id="checkNullModal" tabindex="-1" role="dialog" aria-labelledby="checkNullModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paramsModalLabel">错误提示</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                用户名或密码不能为空
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-danger" data-dismiss="modal" onclick="reset()">重新输入</button>
            </div>
        </div>
    </div>
</div>
<!-- 提示模块（两次密码不一致） -->
<div class="modal fade" id="checkSameModal" tabindex="-1" role="dialog" aria-labelledby="checkSameModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paramsModalLabel">错误提示</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                两次密码不一致，请重新确认
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-danger" data-dismiss="modal" onclick="resetPwd();">重新输入</button>
            </div>
        </div>
    </div>
</div>
<!-- 提示模块（用户名已存在） -->
<div class="modal fade" id="checkUsernameModal" tabindex="-1" role="dialog" aria-labelledby="checkUsernameModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paramsModalLabel">错误提示</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                该用户名已存在，请重新创建
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-danger" data-dismiss="modal" onclick="reset();">重新输入</button>
            </div>
        </div>
    </div>
</div>
<!-- 提示模块（用户名创建成功） -->
<div class="modal fade" id="checkSuccModal" tabindex="-1" role="dialog" aria-labelledby="checkSuccModalLabel"
     aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="paramsModalLabel">成功提示</h5>
                <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                用户创建成功
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary btn-danger" data-dismiss="modal" onclick="gotoLogin();">去登陆</button>
            </div>
        </div>
    </div>
</div>

<script type="text/javascript">
    function checkInput(){
        var username = $("#username").val();
        var password = $("#password").val();
        var confirm_password = $("#confirm_password").val();
        var csrfToken = $("[name='csrfmiddlewaretoken']").val();
        console.log(username,password);
        if(username=="" || password==""){
            {#若为空，跳出为空提示modal#}
            $("#checkNullModal").modal('show');
        }else if(password != confirm_password){
            {#若两次密码不一致，跳出错误提示#}
            $("#checkSameModal").modal('show');
        }else{
            {#若不为空，传值到后台判断是否输入正确#}
            $.ajax({
                type: "POST",//预期服务器返回的数据类型
                dataType:"json",
                url: "/users/checkRegister/" ,//url
                data:{"username":username, 'password':password,
                    'confirm_password':confirm_password, 'csrfmiddlewaretoken':csrfToken},
                success: function (arg) {
                    console.log(arg);//打印服务端返回的数据(调试用)
                    if(arg.status == "success"){
                        console.log("is suc");
                        $("#checkSuccModal").modal("show");
                     }else{
                        console.log("is fail");
                        $("#checkUsernameModal").modal('show');
                    }
                 }
            })
        }
    }

    function reset(){
        $("#username").val("");
        $("#password").val("");
        $("#confirm_password").val("");
    }

    function resetPwd(){
        $("#password").val("");
        $("#confirm_password").val("");
    }

    function hideModal(){
        $("#downloadModal").modal("hide");
    }

    function gotoLogin(){
        window.location.href = '/users/login/';
    }
</script>

<!-- container-scroller -->
<!-- plugins:js -->
<script src="/static/assets/vendors/js/vendor.bundle.base.js"></script>
<script src="/static/assets/vendors/js/vendor.bundle.addons.js"></script>
<!-- endinject -->
<!-- Plugin js for this page-->
<!-- End plugin js for this page-->
<!-- inject:js -->
<script src="/static/assets/js/shared/off-canvas.js"></script>
<script src="/static/assets/js/shared/misc.js"></script>
<!-- endinject -->
<!-- Custom js for this page-->
<!-- End custom js for this page-->
</body>
</html>